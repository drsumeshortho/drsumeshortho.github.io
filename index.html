function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("HTML Submissions");

    const name = e?.parameter?.name || "undefined";
    const age = e?.parameter?.age || "undefined";
    const gender = e?.parameter?.gender || "undefined";
    const phone = e?.parameter?.phone || "undefined";
    const email = e?.parameter?.email || "undefined";
    const problem = e?.parameter?.problem || "undefined";
    const consultationDay = e?.parameter?.consultationDay || "undefined";
    const preferredTime = e?.parameter?.preferredTime || "undefined";
    const preferredExactTime = e?.parameter?.preferredExactTime || "Not mentioned";

    // Save to Google Sheet
    sheet.appendRow([
      new Date(),
      name,
      age,
      gender,
      phone,
      email,
      problem,
      consultationDay,
      preferredTime,
      preferredExactTime
    ]);

    // Email Alert
    MailApp.sendEmail({
      to: "santhosheks@gmail.com",
      subject: `New Online Consultation - ${name}`,
      body: `
🩺 New Consultation Request

📌 Name: ${name}
🎂 Age: ${age}
📱 Phone: ${phone}
🚻 Gender: ${gender}
🦴 Issue: ${problem}
📅 Preferred Day: ${consultationDay}
⏰ Time Slot: ${preferredTime}
🕒 Exact Time: ${preferredExactTime}
📧 Email: ${email}
🕓 Timestamp: ${new Date().toLocaleString('en-IN')}
      `
    });

    return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
  } catch (error) {
    Logger.log("❌ doPost error: " + error);
    return ContentService.createTextOutput("Error: " + error).setMimeType(ContentService.MimeType.TEXT);
  }
}

// ✅ Optional: For browser testing or GET access
function doGet(e) {
  return HtmlService.createHtmlOutput("🟢 This Web App is Active. Form must be submitted via POST.");
}
